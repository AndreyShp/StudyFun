@using BusinessLogic.ExternalData
@using BusinessLogic.ExternalData.Comparisons
@using StudyLanguages
@using StudyLanguages.Configs
@using StudyLanguages.Models
@using StudyLanguages.Models.Sales
@model List<BusinessLogic.ExternalData.Comparisons.ComparisonForUser>

@{
    const string PATTERN_THUMBNAIL = "groupComparison_{0}";
    const SectionId SECTION_ID = SectionId.FillDifference;
    
    ViewBag.ActiveItem = SECTION_ID;
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewBag.IsCentered = true;

    ViewBag.Title = WebSettingsConfig.Instance.GetTemplateText(SECTION_ID, TemplateId.Title);
    ViewBag.Keywords = WebSettingsConfig.Instance.GetTemplateText(SECTION_ID, TemplateId.Keywords);
    ViewBag.Description = WebSettingsConfig.Instance.GetTemplateText(SECTION_ID, TemplateId.Description);
    string header = WebSettingsConfig.Instance.GetTemplateText(SECTION_ID, TemplateId.Header);
    
    Func<ComparisonForUser, string> descriptionGetter = group => 
        group.GetAdditionalInfoByType(AdditionalType.ShortDescription, WebSettingsConfig.Instance.GetTemplateText(SECTION_ID, TemplateId.ShortDescription, group.Title.ToLowerInvariant()));
    Func<ComparisonForUser, string> thumbnailTipGetter = group =>
        group.GetAdditionalInfoByType(AdditionalType.ThumbnailTip, WebSettingsConfig.Instance.GetTemplateText(SECTION_ID, TemplateId.ThumbnailTip, group.Title.ToLowerInvariant()));

    var searchPanelModel = new SearchPanelModel(Model) {
        Tip = WebSettingsConfig.Instance.GetTemplateText(SECTION_ID, TemplateId.SearchTip),
        PatternToSearchContainer = PATTERN_THUMBNAIL
    };
}

@Html.Partial("TopBanner")
<h3 class="h3-groups">@header</h3>
@Html.Partial("PartialSearchPanel", searchPanelModel)

<div class="row">
    @foreach (ComparisonForUser comparison in Model) {
        <div id="@string.Format(PATTERN_THUMBNAIL, comparison.Id)" class="col-sm-6 col-md-3" style="width: auto;">
            <a class="thumbnail cover-text" title='@thumbnailTipGetter(comparison)' href="@Url.Action("Index", RouteConfig.COMPARISON_CONTROLLER, new {group = comparison.Title + "/"}, Request.Url.Scheme)">
                <div class="thumbnail" style="margin-bottom: 0;">
                    <div class="caption">
                        <h3>@comparison.Title</h3> 
                    </div>
                    <p class="thumbnail-text-description">@Html.Raw(descriptionGetter(comparison))</p>
                </div>
            </a>
        </div>
    }
</div>