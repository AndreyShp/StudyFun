UserTasksDetail={Init:function(){var t="#messageContainer",u=$("#commentsList"),f=u.children("li").length,n=$("#commentInput");if(Global.focusClearField(n),GlobalBusiness.maxLengthAttention({field:n,inputTitle:"комментария"}),$("#allRightsPanel").length>0){var i=$("#deleteUserTaskBtn"),r=$("#restoreUserTaskBtn"),e=function(n){var u=ServerData.Patterns.TaskKey,f=ServerData.Patterns.Urls.RemoveOrRestore;$.post(f,{key:u,needRemove:n},$.proxy(function(u){var f=u!=null&&u.success;if(!f){Global.showMessage(t,!1,"Извините, не удалось "+(n?"удалить":"восстановить")+" задание.<br />Попробуйте еще раз через несколько секунд");return}n?(i.hide(),r.show()):(r.hide(),i.show())},this),"json")};i.click(function(){e(!0)}),r.click(function(){e(!1)})}$("#addCommentBtn").click(function(){var i=n.val().trim();if(i==""){Global.showMessage(t,!1,"Некорректные данные!<br />Введите комментарий"),Global.setInputStyle(n,!0);return}i=Global.escapeHTML(i);var r=ServerData.Patterns.AuthorId,e=ServerData.Patterns.TaskKey,o=ServerData.Patterns.Urls.AddComment;$.post(o,{authorId:r,key:e,comment:i,lastShowedComment:f},$.proxy(function(i){var r=i!=null&&i.success;if(!r){Global.showMessage(t,!1,"Извините, не удалось добавить комментарий.<br />Попробуйте еще раз через несколько секунд");return}n.val(""),i.countNewComments!=null&&i.countNewComments>0&&(f+=i.countNewComments,$("#noCommentsMessage").remove(),u.prepend(i.newComments)),GlobalBusiness.Counter.reachGoal(GlobalBusiness.Counter.Ids.UserTaskNewComment)},this),"json")})}},$(function(){UserTasksDetail.Init()});
