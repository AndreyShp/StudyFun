GapsTrainerController={ITEM_CLASS:"gaps-trainer-item",MESSAGE_CONTAINER_ID:"#messageContainer",INPUT_SELECTOR:"input.gaps-trainer-field",elems:null,index:0,count:10,actionOnPortionElems:function(n){var t=this.index+this.count,i;t>this.elems.length&&(t=this.elems.length),i=this.elems.slice(this.index,t),$.each(i,n)},clearContainerStyle:function(n){n.removeClass("alert-danger").removeClass("alert-success")},setContainerStyle:function(n,t){var r=$(n),i;this.clearContainerStyle(r),i=t?"alert-success":"alert-danger",r.addClass(i)},getContainerByElem:function(n){var t=$("."+GapsTrainerController.ITEM_CLASS+'[data-id="'+n.Id+'"]');return t.length>0?t:null},getOriginalTextByElem:function(n){return n.Original.Text},showElements:function(){var n='<table class="table">',r="autofocus";this.actionOnPortionElems(function(t,i){var u,f;for(n+="<tr>",n+='<td class="'+GapsTrainerController.ITEM_CLASS+'" data-id="'+i.Id+'">',u=0;u<i.TextForUser.length;u++)f=i.TextForUser[u],f==ServerData.Patterns.GapChar?(n+='<input class="gaps-trainer-field form-control" type="text" maxLength="1" autocomplete="off" '+r+"/>",r=""):n+=f,n+=" ";return n+="</td>",n+='<td class="gaps-trainer-answer">'+Speaker.GetHtml(i.Original,ServerData.Patterns.SpeakerType)+"</td>",n+='<td class="gaps-trainer-translation">'+Speaker.GetHtml(i.Translation,ServerData.Patterns.SpeakerType)+"</td>",n+="</tr>",!0}),n+="</table>",$("#gapsTrainerContainer").html(n);var t=$(GapsTrainerController.INPUT_SELECTOR),u=function(n){var t=$(n).val(),i=t.length;return i>0},i=function(n,i){var u=t.index(n),r=u+i;r>=0&&r<t.length&&t.eq(r).focus()},f=function(n){var t=0,i;return document.selection?(n.focus(),i=document.selection.createRange(),i.moveStart("character",-n.value.length),t=i.text.length):(n.selectionStart||n.selectionStart=="0")&&(t=n.selectionStart),t};t.keypress(function(n){var t=n.keyCode||n.which,e=u(this),r=f(this);(r!=0||e)&&r!=1||t!=39?r==0&&(t==8||t==37)&&i(this,-1):i(this,1)}).on("input",function(){u(this)?i(this,1):i(this,-1)}).focus(function(){GapsTrainerController.clearContainerStyle($(this))}),this.answerToogleBtn=new ToggleBtn({block:$(".gaps-trainer-answer"),btn:$("#answerToogleBtn"),cookieName:null,captionShow:"Показать правильный ответ &raquo;",captionHide:"Спрятать правильный ответ &laquo;",isHidden:!0}),this.translationToogleBtn=new ToggleBtn({block:$(".gaps-trainer-translation"),btn:$("#translationToogleBtn"),cookieName:null,captionShow:"Показать перевод &raquo;",captionHide:"Спрятать перевод &laquo;",isHidden:!0}),this.isAnswerClicked=!1,this.isTranslationClicked=!1},toogleLoadNextBtn:function(){var n=$("#loadNextPortionBtn");this.index+this.count<this.elems.length?n.show():n.hide()},Init:function(){this.elems=GlobalBusiness.shuffle(ServerData.Elements),this.showElements(),this.toogleLoadNextBtn()},ToogleAnswer:function(){this.isAnswerClicked=!0,this.answerToogleBtn.Toogle()},ToogleTranslation:function(){this.isTranslationClicked=!0,this.translationToogleBtn.Toogle()},Check:function(){var i=ServerData.Patterns.GapChar,t=function(n,t){return n.indexOf(i,t)},n=!0;this.actionOnPortionElems(function(i,r){var e=GapsTrainerController.getContainerByElem(r),o=r.TextForUser,s=GapsTrainerController.getOriginalTextByElem(r),f=-1,h=e.find(GapsTrainerController.INPUT_SELECTOR),u;return $.each(h,function(i,r){var u,e;return(f=t(o,f+1),u=$(r).val(),u.length==0)?(GapsTrainerController.setContainerStyle(r,!1),n=!1,!0):(e=s.charAt(f).toLowerCase(),u.toLowerCase()==e?GapsTrainerController.setContainerStyle(r,!0):(GapsTrainerController.setContainerStyle(r,!1),n=!1),!0)}),n?(u="Ошибок нет. Отличная работа!",u+=GapsTrainerController.isAnswerClicked?" Попробуйте в следующий раз не смотреть ответ.":GapsTrainerController.isTranslationClicked?" Попробуйте в следующий раз не смотреть перевод.":" Продолжайте в том же духе.",Global.showMessage(GapsTrainerController.MESSAGE_CONTAINER_ID,!0,u)):Global.showMessage(GapsTrainerController.MESSAGE_CONTAINER_ID,!1,"Вы допустили ошибки. Обратите внимание на ячейки подсвеченные красным цветом"),!0})},LoadNextPortion:function(){var n=this.index+this.count;n<this.elems.length&&(this.index=n,this.showElements()),this.toogleLoadNextBtn()}},$(function(){GapsTrainerController.Init()});
