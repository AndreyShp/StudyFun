VisualDictionaryController={Init:function(){var t="#image",i,r,n;UserKnowledge.CheckExistenceIds(),this.translationToogleBtn=new ToggleTranslateBtn({translated:$(".visual-translate-word-container"),translatedToogle:$("#translationToogleId")}),this.areas=ServerData.Areas,this.lastSpoken=null,i=new AutoPronounceCheckBox,this.speakIfNeed=function(n){var t=i.IsChecked();Speaker.SpeakElemPartByLanguage(t,n,ServerData.SpeakerHelper.Ids.Word)},r=$.proxy(function(n,t,i){var r="visual-unselected-word",u=!1;(i&&(this.lastSpoken=null),$.each(this.areas,$.proxy(function(i,f){return n&&f!=t?f.wordContainer.addClass(r):f.wordContainer.removeClass(r),u|=f==t,!0},this)),n&&u&&this.lastSpoken!=t)&&(this.lastSpoken=t,window.setTimeout($.proxy(function(){this.lastSpoken==t&&this.speakIfNeed(this.lastSpoken)},this),200))},this),this.changeLanguageObserver=$.proxy(function(n){var t=function(n,t,i){var r=Speaker.GetWordHtml(i);$(String.format(n,t.Id)).html(r)};$.each(this.areas,function(i,r){var u,f;r.Source.LanguageId==n?(u=r.Source,f=r.Translation):(u=r.Translation,f=r.Source),t("#sourceWord_{0}",r,u),t("#translatedWord_{0}",r,f)}),$(window).resize()},this),LanguagePanel.AddObserver($.proxy(this.changeLanguageObserver,this));var f=$.proxy(function(n){var t,i,u=LanguagePanel.GetSourceLanguageId(),r;return n.Source.LanguageId==u?(t=n.Source,i=n.Translation):(i=n.Source,t=n.Translation),r=t.Text,this.translationToogleBtn.IsVisible()&&(r+=" - "+i.Text),r},this),e=function(n){Speaker.SpeakElemPartByLanguage(!0,n,ServerData.SpeakerHelper.Ids.Word)},u=function(n){var i=new MultiImageAreasSelector({imageContainer:t,originalImageWidth:ServerData.Size.Width,originalImageHeight:ServerData.Size.Height,onChangeSelection:r,getAreaTitle:f,onClickArea:ServerData.CanPronounce?e:null});return $.each(n,function(n,t){i.AddArea(t,t.LeftUpperCorner.X,t.LeftUpperCorner.Y,t.RightBottomCorner.X,t.RightBottomCorner.Y),t.wordContainer=$(String.format("#wordContainer_{0}",t.Id)),t.wordContainer.mouseleave(function(){i.CleanSelection(!0)}).mouseover(function(){i.ShowSelection(t)})}),i};$(t).load(function(){$(window).resize&&$(window).resize()}),n=u(this.areas),$(window).resize($.proxy(function(){n.Clear(),n=u(this.areas)},this)),GlobalBusiness.newVisitor(ServerData.Patterns.UrlNewVisitor)},ToogleTranslation:function(){var n=this.translationToogleBtn.Toogle();return $(window).resize(),n}},$(function(){VisualDictionaryController.Init()});var MultiImageAreasSelector=function(n){var f="multi-image-selected-area",e="multi-image-area",u="multi-image-dark-area",o=!1,v=function(n){var t=function(n,t){return t.square-n.square};$.each(n.sort(t),function(n,t){t.areaCtrl.css("zIndex",n)})},i=$(n.imageContainer),s=function(n,t,r,u,f){var e=String.format("<div class='{0}' style='left:{1}px;top:{2}px;width:{3}px;height:{4}px;'></div>",n,t,r,u,f);return $(e).insertAfter(i)},h=n.onChangeSelection,y=n.getAreaTitle,c=n.onClickArea,l=i.width()/n.originalImageWidth,a=i.height()/n.originalImageHeight,t,r;this.areas=[],t=i.position(),this.darkAreas=[],this.selectedAreas=[],this.AddArea=function(n,i,r,u,f){var h=parseInt(t.left+i*l),v=parseInt(t.top+r*a),y=parseInt(t.left+u*l),p=parseInt(t.top+f*a),w=y-h,b=p-v,o=s(e,h,v,w,b),k;o.mouseleave($.proxy(function(){this.CleanSelection(!0)},this)),o.mouseover($.proxy(function(){this.ShowSelection(n)},this)),c!=null&&(o.css("cursor","pointer"),o.click($.proxy(function(){c(n)},this))),k={id:n,coordinates:{x1:i,y1:r,x2:u,y2:f},absoluteCoordinates:{x1:h,y1:v,x2:y,y2:p},areaCtrl:o,square:w*b},this.areas.push(k)},this.ShowSelection=function(n){var a;o||(o=!0,v(this.areas)),this.CleanSelection(),a=this.selectedAreas,$.each(this.areas,function(t,i){var r=n==i.id,u;return r&&(a.push(i),i.areaCtrl.addClass(f),u=y(i.id),i.areaCtrl.attr("title",u),h(!0,i.id)),!r});var r=parseInt(t.left),c=parseInt(t.top),l=parseInt(i.width()),p=parseInt(i.height()),e=$.proxy(function(n,t,i,r){s(u,n,t,i,r)},this);$.each(this.selectedAreas,function(n,t){var i=t.absoluteCoordinates,u=i.x1-r,f=i.y1-c,o=r+l-i.x2,s=c+p-i.y2;u>0&&e(r,i.y1,u+1,i.y2-i.y1+1),f>0&&e(r,c,l,f),o>0&&e(i.x2+1,i.y1,o-1,i.y2-i.y1+1),s>0&&e(r,i.y2+1,l,s)})},r=function(n){$(String.format(".{0}",n)).remove()},this.CleanSelection=function(n){r(u),$.each(this.selectedAreas,function(t,i){return i.areaCtrl.removeClass(f),h(!1,i.id,n),!0}),this.selectedAreas=[]},this.Clear=function(){r(u),r(e)}};
