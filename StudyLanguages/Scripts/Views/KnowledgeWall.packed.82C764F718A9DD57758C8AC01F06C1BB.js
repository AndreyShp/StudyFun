KnowledgeWall={MEDIA_SELECTOR:".media",Init:function(){var n=null,i=this.MEDIA_SELECTOR,r=new LanguageObserverHelper,o=$(i),e;$.each(o,function(t,i){var u=$(i).data("id");u&&(u<n||!n)&&(n=u),r.AddRow(i)});var u=!1,t=!1,f=function(){if(!u&&!t){t=!0;var f=ServerData.GetPath(ServerData.Patterns.Urls.LoadingData);$.getJSON(f,{prevId:n},function(f){var e,s,o;if(f==null||f.success===!1){PopupAlert.Show("Не удалось подгрузить данные. Попробуйте прокрутить страницу вверх и вниз"),t=!1;return}e=f.items,e.length==0&&(u=!0),s=f.sourceLanguageId,o=$("#"+ServerData.Patterns.ItemsContainerId),$.each(e,function(t,u){var f=$(u),e=f.data("id"),h;e<n&&(n=e),o.append(f),h=o.find(i+":last"),r.AddRow(h,s)}),t=!1})}};$(window).scroll(function(){var n=$(window).scrollTop()+$(window).height(),t=$(document).height(),i=$(window).height();n<t-i||f()}),e=$("body").height()>$(window).height(),e||f()},Remove:function(n){var t=$(n).parents(this.MEDIA_SELECTOR),f=t.data("id"),i,r,u;f&&(i=t.find(".knowledge-wall-content"),i.hide(),r=t.find(".knowledge-wall-restore"),u=function(n){var t=ServerData.GetPath(ServerData.Patterns.Urls.RemoveOrRestore);$.post(t,{id:f,needRemove:n.needRemove},function(t){var i=t!=null&&t.success;if(!i){PopupAlert.Show(n.errorMessage);return}n.success()},"json")},u({needRemove:!0,success:function(){r.show().unbind("click").click(function(){var n={needRemove:!1,success:function(){i.show(),r.hide()},errorMessage:"Не удалось восстановить порцию знаний! Попробуйте позже."};u(n)})},errorMessage:"Не удалось удалить порцию знаний! Попробуйте позже."}))}},$(function(){KnowledgeWall.Init()});
